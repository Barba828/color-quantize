var r=function(o,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(r[t]=o[t])},r(o,t)};var o=function(o){function t(r){void 0===r&&(r=function(r,o){return Number(r)-Number(o)});var t=o.call(this)||this;return t._comparator=r,t._sorted=!1,t.sort=function(r){return t._comparator=r||t._comparator,t._sorted=!0,o.prototype.sort.call(t,t._comparator)},t.push=function(r){return t._sorted=!1,o.prototype.push.call(t,r)},t.pop=function(){return t._sorted||t.sort(),o.prototype.pop.call(t)},t.peek=function(r){return t._sorted||t.sort(),void 0===r&&(r=t.length-1),t[r]},t.size=function(){return t.length},t.debug=function(){return t._sorted||t.sort(),t},t}return function(o,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=o}r(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,o),t}(Array),t=function r(o,t,e,u,c,i,f){var a=this;this.r1=o,this.r2=t,this.g1=e,this.g2=u,this.b1=c,this.b2=i,this.histo=f,this._count=-1,this.volume=function(r){return a._volume&&!r||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},this.count=function(r){return a._count>-1&&!r||(a._count=a.histo.reduce((function(r,o){return r+(o||0)}),0)),a._count},this.copy=function(){return new r(a.r1,a.r2,a.g1,a.g2,a.b1,a.b2,a.histo)},this.avg=function(r){if(a._avg&&r)return a._avg;var o,t,e,u,c,i=0,f=1<<n,p=0,v=0,b=0;for(t=a.r1;t<=a.r2;t++)for(e=a.g1;e<=a.g2;e++)for(u=a.b1;u<=a.b2;u++)c=s(t,e,u),i+=o=a.histo[c]||0,p+=o*(t+.5)*f,v+=o*(e+.5)*f,b+=o*(u+.5)*f;return a._avg=i?[~~(p/i),~~(v/i),~~(b/i)]:[~~(f*(a.r1+a.r2+1)/2),~~(f*(a.g1+a.g2+1)/2),~~(f*(a.b1+a.b2+1)/2)],a._avg},this.contains=function(r){var o=r.map((function(r){return r>>n})),t=o[0],e=o[1],u=o[2];return t>=a.r1&&t<=a.r2&&e>=a.g1&&e<=a.g2&&u>=a.b1&&u<=a.b2}},n=3,e=function(r,o){return r<o?-1:r>o?1:0},u=function(r,o){return r.reduce((function(t,n){return t+(o?o.call(r,n):n)}),0)},c=function(r,o){return Math.max.apply(null,o?r.map(o):r)},i=function(r){return r.reduce((function(r,o){return o?r+1:r}),0)},s=function(r,o,t){return(r<<10)+(o<<5)+t},f=function(r,o){if(!o.count())return[];if(1==o.count())return[o.copy()];var t,n,e,u,i=o.r2-o.r1+1,f=o.g2-o.g1+1,a=o.b2-o.b1+1,p=c([i,f,a]),v=[],b=0;if(p===i)for(t=o.r1;t<=o.r2;t++){for(u=0,n=o.g1;n<=o.g2;n++)for(e=o.b1;e<=o.b2;e++)u+=r[s(t,n,e)]||0;b+=u,v[t]=b}else if(p===f)for(t=o.g1;t<=o.g2;t++){for(u=0,n=o.r1;n<=o.r2;n++)for(e=o.b1;e<=o.b2;e++)u+=r[s(n,t,e)]||0;b+=u,v[t]=b}else for(t=o.b1;t<=o.b2;t++){for(u=0,n=o.r1;n<=o.r2;n++)for(e=o.g1;e<=o.g2;e++)u+=r[s(n,e,t)]||0;b+=u,v[t]=b}var h=function(r){for(var t,n,e,u,c,i=r+"1",s=r+"2",f=o[i];f<=o[s];){if(!(v[f]<b/2)){for(e=o.copy(),u=o.copy(),c=(t=f-o[i])<=(n=o[s]-f)?Math.min(o[s]-1,~~(f+n/2)):Math.max(o[i],~~(f-1-t/2));!v[c];)c++;return e[s]=c,u[i]=c+1,[e,u]}f++}return[]};return h(p===i?"r":p===f?"g":"b")},a=function(){function r(){var t=this;this.push=function(r){t.vboxes.push({vbox:r,color:r.avg()})},this.palette=function(){return t.vboxes.map((function(r){return r.color}))},this.size=function(){return t.vboxes.size()},this.map=function(r){for(var o=0;o<t.vboxes.size();o++)if(t.vboxes.peek(o).vbox.contains(r))return t.vboxes.peek(o).color;return t.nearest(r)},this.nearest=function(r){var o,n,e,u;for(o=0;o<t.vboxes.size();o++)((e=Math.sqrt(Math.pow(r[0]-t.vboxes.peek(o).color[0],2)+Math.pow(r[1]-t.vboxes.peek(o).color[1],2)+Math.pow(r[2]-t.vboxes.peek(o).color[2],2)))<n||void 0===n)&&(n=e,u=t.vboxes.peek(o).color);return u},this.forcebw=function(){t.vboxes.sort((function(r,o){return e(u(r.color),u(o.color))}));var o=t.vboxes[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(t.vboxes[0].color=[0,0,0]);var n=t.vboxes.length-1,c=t.vboxes[n].color;c[0]>251&&c[1]>251&&c[2]>251&&(t.vboxes[n].color=[255,255,255]),t.vboxes.sort(r._compare)},this.vboxes=new o(r._compare)}return r._compare=function(r,o){return e(r.vbox.count()*r.vbox.volume(),o.vbox.count()*o.vbox.volume())},r}(),p=function(r,u){if(!r.length||u<1||u>256)return new a;var c=function(r){var o,t,e,u,c=new Array(32768);return r.forEach((function(r){var i;i=r.map((function(r){return r>>n})),t=i[0],e=i[1],u=i[2],o=s(t,e,u),c[o]=(c[o]||0)+1})),c}(r);i(c);var p=function(r,o){var e,u,c,i=1e6,s=0,f=1e6,a=0,p=1e6,v=0;return r.forEach((function(r){var o;o=r.map((function(r){return r>>n})),e=o[0],u=o[1],c=o[2],e<i?i=e:e>s&&(s=e),u<f?f=u:u>a&&(a=u),c<p?p=c:c>v&&(v=c)})),new t(i,s,f,a,p,v,o)}(r,c),v=new o((function(r,o){return e(r.count(),o.count())}));v.push(p);var b=function(r,o){for(var t,n=r.size(),e=0;e<1e3;){if(n>=o)return;if(e++>1e3)return;if(r.peek().count()){t=r.pop();var u=f(c,t),i=u[0],s=u[1];if(!i)return;r.push(i),s&&(r.push(s),n++)}else e++}};b(v,.75*u),v.sort((function(r,o){return e(r.count()*r.volume(),o.count()*o.volume())})),b(v,u);for(var h=new a;v.size();)h.push(v.pop());return h};export{p as quantize};
